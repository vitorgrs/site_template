---

layout: manager
---


<link rel="stylesheet" href="site_template\assets\css\form_projeto.scss">

<h1 class="tituloForm">Cadastre um novo projeto</h1>

<form id="form_projeto" onsubmit="return false">

    <div id="form_fields">
        <label for="titulo" class="labelName">Título </label>
        <input type="text" name="proj_titulo" id="titulo" required placeholder="Insira seu título aqui" />
        
        <label for="subtitulo" class="labelName">Subtítulo </label>
        <input type="text" name="proj_subtitulo" id="subtitulo" required placeholder="Insira seu subtítulo aqui"/>

        <label for="grupo_projeto" class="labelName">Grupo</label>
        <input list="grupos" id="grupo" name="grupo_projeto" required placeholder="Selecione seu grupo">
        
        <label for="filefoto" class="labelName" id="labelFoto">Imagem</label>
        <input type="file" name="filefoto" id="filefoto">
        

        <label for="link_projeto" class="labelName">Link do projeto</label>
        <input type="text" name="link_projeto" id = "link_input" required placeholder="https://github.com/...">
        

        <label for="desc_projeto" class="labelName">Descrição</label>
        <textarea name="desc_projeto" id="txt_desc_proj"></textarea>

        <label for="chip_projeto" class="labelName">Tags</label>
        <input type="text" name="chip" id="addChip" placeholder="Ex: Machine Learning, PLN">
        <div class="chip-container"></div>

        <div class="buttonRow">
            <button type="button" class="cancelarButton">Cancelar</button>
            <button type="submit" class="enviarButton" id="enviarButton">Enviar</button>
        </div>
    </div>

    <datalist id="grupos">
        <option value="NCA"></option>
        <option value="Equatorial"></option>
    </datalist>
</form>

<script>
    const chipContainer = document.querySelector(".chip-container");
    
    function createChip(name){
        const chip = document.createElement("div");
        //chip element
        chip.classList.add("chip")
        //chip avatar element
        const chipName = document.createElement("div"); 
        chipName.classList.add("chipText");
        chipName.textContent = name; 
        const closeIcon = document.createElement("div"); 
        closeIcon.classList.add("close-icon"); 
        closeIcon.textContent = "x"; 
        closeIcon.addEventListener( 
            "click", 
            function () { 
                chip.remove(); 
            }); 
        chip.appendChild(chipName); 
        chip.appendChild(closeIcon); 
        chipContainer.appendChild(chip);
    }

    const addChipInput = document.getElementById("addChip")

    addChipInput.addEventListener('keydown', function(e){
        if(e.key == 'Enter'){
            event.preventDefault();
            const name = addChipInput.value.trim();
            if (name !== ""){
                createChip(name);
                addChipInput.value = "";
            }
        }
    })

    const apiProjUrl = "http://localhost:3000/submit";


    formProjeto = document.getElementById("form_projeto")

    
    if (formProjeto){
        formProjeto.addEventListener("submit", (e) =>{
            e.preventDefault();
            formData = new FormData(formProjeto);
            const data = {
                'proj_titulo' : formData.get('proj_titulo'),
                'proj_subtitulo': formData.get('proj_subtitulo'),
                'grupo_projeto': formData.get('grupo_projeto'),
                'filefoto': formData.get('filefoto'),
                'link_projeto': formData.get('link_projeto'),
                'desc_projeto': formData.get('desc_projeto'),
                'chip': [] 
            }

            const chips = document.getElementsByClassName('chip');
            
            var result = Object.keys(chips).map((key) => [chips[key]]);

            result.forEach(elem => {
                text = elem[0]['innerText'];
                //Regex para lidar com a quebra de linha das tags
                text = text.split(/[\r\n]/g)[0];
                data.chip.push(text);
            })

            const requestOptions = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            };

            fetch(apiProjUrl, requestOptions)
            .then(response => {
                if (!response.ok){
                    throw new Error('Erro ao chamar API');
                }
                return response.json();
            })
        })
    }


</script>